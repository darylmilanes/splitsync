<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- MOBILE OPTIMIZATION -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#FFFFFF"> 

    <title>SplitSync</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- TOAST & MODALS -->
    <div id="toast-container"></div>
    <div id="confirm-modal-overlay" class="confirm-modal-overlay">
        <div class="confirm-box">
            <div class="confirm-title" id="confirm-title">Confirm</div>
            <div class="confirm-msg" id="confirm-msg">Are you sure?</div>
            <div class="confirm-actions">
                <button class="btn btn-cancel" onclick="closeConfirm(false)">Cancel</button>
                <button class="btn btn-save" id="confirm-yes-btn" onclick="closeConfirm(true)">Yes</button>
            </div>
        </div>
    </div>

    <!-- LOGIN -->
    <div id="login-screen">
        <img src="icon-512.png" class="login-logo" alt="Logo">
        <div class="login-title">SplitSync</div>
        <div class="login-subtitle">Enter the code to access<br>your shared finances.</div>
        <input type="password" id="login-code" class="login-input" placeholder="CODE" maxlength="10" />
        <button class="login-btn" onclick="attemptLogin()">Enter</button>
    </div>

    <!-- HEADER -->
    <header>
        <div class="brand">
            <img src="favicon.png" alt="Logo">
            <h1>SplitSync</h1>
        </div>
        <div class="header-actions">
            <div class="room-badge" id="room-display">...</div>
            <button class="icon-btn" onclick="openStats()" title="Dashboard">
                 <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
            </button>
            <button class="icon-btn" onclick="openSettings()" title="Settings">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
            <button class="icon-btn" onclick="logout()" title="Exit">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            </button>
        </div>
    </header>

    <!-- MAIN -->
    <main>
        <div class="card">
            <div class="balance-title">Pool Balance (Carryover)</div>
            <div class="balance-amount" id="pool-balance">...</div>
            <div id="status-display"><span style="color: var(--text-muted); font-size: 14px;">Syncing...</span></div>
        </div>

        <span class="section-title">Latest Activity</span>
        <div id="transaction-list">
            <div class="loading-spinner">Connecting to SplitSync Cloud...</div>
        </div>
    </main>

    <div class="fab" onclick="openAddModal()">
        <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"></path></svg>
    </div>

    <!-- MODAL: ADD/EDIT -->
    <div id="add-modal-overlay" class="modal-overlay" onclick="closeModal('add')">
        <div class="modal-sheet" id="add-sheet-content" onclick="event.stopPropagation()">
            
            <div class="toggle-container" id="mode-toggle">
                <div id="tab-burn" class="toggle-btn active burn" onclick="setMode('burn')">Expense (Burn)</div>
                <div id="tab-fuel" class="toggle-btn" onclick="setMode('fuel')">Contribution (Fuel)</div>
            </div>

            <!-- Date Field (Shared) -->
            <div class="input-group" id="grp-date">
                <label class="input-label">Date</label>
                <input type="date" id="inp-date" class="input-field">
            </div>

            <!-- Amount -->
            <div class="input-group">
                <label class="input-label">Amount</label>
                <input type="number" id="inp-amount" class="input-field input-amount" placeholder="0" inputmode="decimal">
            </div>

            <!-- Who & Category (Flex Layout) -->
            <div class="input-group" style="display:flex; gap: 15px;">
                <div style="flex:1" id="grp-user">
                    <label class="input-label" id="lbl-user">Who Paid?</label>
                    <select id="inp-user" class="input-field"></select>
                </div>
                <div style="flex:1" id="grp-cat">
                    <label class="input-label">Category</label>
                    <select id="inp-cat" class="input-field"></select>
                </div>
            </div>

            <!-- Description -->
            <div class="input-group">
                <label class="input-label">Description (Optional)</label>
                <input type="text" id="inp-desc" class="input-field" placeholder="e.g. Groceries">
            </div>
            
            <input type="hidden" id="edit-id" value="">

            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeModal('add')">Cancel</button>
                <button id="btn-save" class="btn btn-save burn" onclick="saveTransaction()">Burn</button>
            </div>
        </div>
    </div>

    <!-- MODAL: DASHBOARD -->
    <div id="stats-modal-overlay" class="modal-overlay" onclick="closeModal('stats')">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title">Dashboard</span>
                <button class="icon-btn" onclick="closeModal('stats')">Close</button>
            </div>

            <div class="toggle-container">
                <div id="tab-month" class="toggle-btn active" onclick="setStatsView('month')">Monthly</div>
                <div id="tab-year" class="toggle-btn" onclick="setStatsView('year')">Yearly</div>
            </div>
            
            <div class="filter-controls">
                <button class="nav-btn" onclick="changeStatsPeriod(-1)">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                </button>
                <span id="period-display" class="period-display">...</span>
                <button class="nav-btn" onclick="changeStatsPeriod(1)">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
            </div>

            <div id="dash-content"></div>
        </div>
    </div>

    <!-- MODAL: SETTINGS -->
    <div id="settings-modal-overlay" class="modal-overlay" onclick="closeModal('settings')">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title">Group Settings</span>
                <button class="icon-btn" onclick="closeModal('settings')">Done</button>
            </div>

            <div class="input-group">
                <label class="input-label">Total Monthly Target</label>
                <input id="inp-budget-display" type="text" class="input-field" disabled style="background:#F1F5F9; color:var(--text-muted)">
            </div>

            <!-- Setup Categories -->
            <div class="input-group">
                <label class="input-label">Category Budgets (Click to Edit)</label>
                <div class="add-row">
                    <input id="new-cat-name" class="input-field" style="padding: 10px; font-size: 16px; flex:2" placeholder="Item (e.g. Rent)">
                    <input id="new-cat-amount" type="number" class="input-field" style="padding: 10px; font-size: 16px; flex:1" placeholder="Amount">
                    <button class="btn-small" id="btn-add-cat" onclick="addItem('categories')">Add</button>
                </div>
                <div id="categories-list" class="chip-list"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Team Members</label>
                <div class="add-row">
                    <input id="new-member" class="input-field" style="padding: 10px; font-size: 16px;" placeholder="Name (e.g. Alice)">
                    <button class="btn-small" onclick="addItem('members')">Add</button>
                </div>
                <div id="members-list" class="chip-list" style="flex-direction:row; flex-wrap:wrap"></div>
            </div>

            <p style="color:var(--text-muted); font-size:12px; margin-top:20px; text-align:center;">
                Changes save to room <span id="settings-room-id"></span>
            </p>
        </div>
    </div>

    <!-- LOGIC -->
    <script type="module" src="app.js"></script>
</body>
</html>
